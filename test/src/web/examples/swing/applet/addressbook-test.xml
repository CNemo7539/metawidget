<project name="swing-applet-addressbook-test" default="test-all">

	<property file="../../../../../../build.properties" />
	<property file="../../../../../build.properties" />

	<path id="webtest.path.id">
		<pathelement location="${webtest.dir}/lib"/>
		<fileset dir="${webtest.dir}/lib" includes="*.jar"/>
		<fileset dir="../../../../../../${build.dir}/examples/swing/applet/addressbook" includes="*.jar"/>
		<fileset dir="../../../../../lib" includes="emma.jar"/>
	</path>
	
    <taskdef resource="webtest.taskdef" loaderref="webtest.loader" classpathref="webtest.path.id"/>

	<!-- Test Applet Loads (more thorough testing is done by SwingAddressBookTest) -->
				
	<target name="test-all">
		<webtest name="test-loads">
			<config resultpath="../../../../../../${build.dir}/run/logs"/>
			<steps>
				<invoke url="file://${basedir}/../../../../../../${build.dir}/examples/swing/applet/addressbook/index.html" />
				<verifyTitle text="Address Book (Metawidget Swing Applet Example)" />

				<!-- Test contacts row count. Note this makes a new AddressBookApplet, it does not test the -->
				<!-- one actually on the page. We couldn't figure out how to get testing with appletRunner  -->
				<!-- working (see http://lists.canoo.com/pipermail/webtest/2008q2/010687.html)              -->
				
				<groovy>
					def applet = new org.metawidget.example.swing.applet.AddressBookApplet();
					def label = applet.getComponent( 0 );
					step.setWebtestProperty( 'labelClass', label.getClass().getName());
					def panel = applet.getComponent( 1 );
					step.setWebtestProperty( 'backgroundOpaque', String.valueOf( panel.isOpaque() ));
					step.setWebtestProperty( 'backgroundRed', String.valueOf( panel.getBackground().getRed() ));
					step.setWebtestProperty( 'backgroundGreen', String.valueOf( panel.getBackground().getGreen() ));
					step.setWebtestProperty( 'backgroundBlue', String.valueOf( panel.getBackground().getBlue() ));
					def metawidget = panel.getComponent( 0 );
					step.setWebtestProperty( 'metawidgetClass', metawidget.getClass().getName());
					metawidget.setConfig( null );
					metawidget.setInspector( new org.metawidget.inspector.propertytype.PropertyTypeInspector() );
					metawidget.setInspectionResultProcessors( null );
					metawidget.setWidgetBuilder( new org.metawidget.swing.widgetbuilder.SwingWidgetBuilder() );
					metawidget.setWidgetProcessors( null );
					metawidget.setMetawidgetLayout( new org.metawidget.swing.layout.SeparatorLayoutDecorator( new org.metawidget.swing.layout.SeparatorLayoutDecoratorConfig().setLayout( new org.metawidget.swing.layout.GridBagLayout() )));
					step.setWebtestProperty( 'metawidgetComponentCount', String.valueOf( metawidget.getComponentCount() ));
					def contacts = panel.getComponent( 1 );
					step.setWebtestProperty( 'contactsClass', contacts.getClass().getName() );
					step.setWebtestProperty( 'contacts', String.valueOf( contacts.getViewport().getView().getRowCount() ));
				</groovy>
				<verifyProperty name="labelClass" text="javax.swing.JLabel"/>
				<verifyProperty name="metawidgetClass" text="org.metawidget.swing.SwingMetawidget"/>
				<verifyProperty name="metawidgetComponentCount" text="7"/>
				<verifyProperty name="backgroundOpaque" text="true"/>
				<verifyProperty name="backgroundRed" text="255"/>
				<verifyProperty name="backgroundGreen" text="255"/>
				<verifyProperty name="backgroundBlue" text="255"/>
				<verifyProperty name="contactsClass" text="javax.swing.JScrollPane"/>
				<verifyProperty name="contacts" text="6"/>
			</steps>
		</webtest>
	</target>
</project>
