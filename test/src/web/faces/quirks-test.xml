<project name="faces-quirks-test" default="test-all">

	<property file="../../../../build.properties" />
	<import file="${webtest.dir}/webtest.xml" />

	<target name="test-all" depends="wt.defineTasks">
		<webtest name="test-faces">
			<config resultpath="../../../../${build.dir}"/>
			<steps>
				<invoke url="${webtest.url}/quirks-faces" />

				<verifyXPath xpath="/html/body/form/table[1]/@id" text="form:quirksMetawidget"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[1]/th" text="42 boolean:"/>
				
				<!-- Test the 'not tri-state if not listbox' in HtmlMetawidget.buildActiveWidget -->

				<verifyXPath xpath="count(/html/body/form/table[1]/tbody/tr[1]/td[1]/table/tbody/tr/td)" text="2"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[1]/td[1]/table/tbody/tr/td[1]/input/@type" text="radio"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[1]/td[1]/table/tbody/tr/td[1]/label, 'Yes (i18n)')"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[1]/td[1]/table/tbody/tr/td[2]/input/@type" text="radio"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[1]/td[1]/table/tbody/tr/td[2]/label, 'No (i18n)')"/>

				<!-- Test spanning of large components that don't have a label -->
								
				<verifyXPath xpath="count(/html/body/form/table[1]/tbody/tr[2]/th)" text="0"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[2]/td[1]/textarea/@id" text="form:quirksLarge"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[2]/td[1]/@colspan" text="5"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[2]/td[2]" text="*"/>

				<!-- Test Lists with a UiLookup -->
								
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/th[1]" text="Strings:"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/td[1]/table/tbody/tr/td[1]/input[@type='checkbox']/@value" text="Foo"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[3]/td[1]/table/tbody/tr/td[1]/label, 'Foo')"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/td[1]/table/tbody/tr/td[2]/input[@type='checkbox']/@value" text="Bar"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[3]/td[1]/table/tbody/tr/td[2]/label, 'Bar')"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/td[1]/table/tbody/tr/td[3]/input[@type='checkbox']/@value" text="Baz"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[3]/td[1]/table/tbody/tr/td[3]/label, 'Baz')"/>
				<verifyXPath xpath="count(/html/body/form/table[1]/tbody/tr[3]/td[1]/table/tbody/tr/td)" text="3"/>

				<!-- Test Lists with a FacesLookup -->
								
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/th[2]" text="Integers:"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr[1]/td/input[@type='checkbox']/@value" text="1"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr[1]/td/label, '1' )"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr[2]/td/input[@type='checkbox']/@value" text="2"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr[2]/td/label, '2' )"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr[3]/td/input[@type='checkbox']/@value" text="3"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr[3]/td/label, '3' )"/>
				<verifyCheckbox htmlid="form:quirksIntegers:2" checked="false"/>
				<setCheckbox htmlid="form:quirksIntegers:2" checked="true"/>				
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr[4]/td/input[@type='checkbox']/@value" text="4"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr[4]/td/label, '4' )"/>
				<verifyXPath xpath="count(/html/body/form/table[1]/tbody/tr[3]/td[3]/table/tbody/tr)" text="4"/>

				<!-- Test Arrays with a UiLookup -->
								
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[4]/th[1]" text="String array:"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[4]/td[1]/table/tbody/tr/td[1]/input[@type='checkbox']/@value" text="Foo2"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[4]/td[1]/table/tbody/tr/td[1]/label, 'Foo2' )"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[4]/td[1]/table/tbody/tr/td[2]/input[@type='checkbox']/@value" text="Bar2"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[4]/td[1]/table/tbody/tr/td[2]/label, 'Bar2' )"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[4]/td[1]/table/tbody/tr/td[3]/input[@type='checkbox']/@value" text="Baz2"/>
				<verifyXPath xpath="normalize-space(/html/body/form/table[1]/tbody/tr[4]/td[1]/table/tbody/tr/td[3]/label, 'Baz2' )"/>
				<verifyXPath xpath="count(/html/body/form/table[1]/tbody/tr[4]/td[1]/table/tbody/tr/td)" text="3"/>

				<!-- Test converters on Lists with a FacesLookup -->
								
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[4]/th[2]" text="Read only lookup with labels:"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[4]/td[3]" text="[Foo, Bar]"/>

				<!-- Test DataTableWidgetBuilder -->
								
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/th" text="List:"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/@class" text="aDataTableStyleClass"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/thead/tr/th[1]" text="Name label"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/thead/tr/th[2]" text="Description"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[1]/@class" text="aDataTableRowClass1"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[1]/td[1]" text="Foo"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[1]/td[1]/@class" text="aDataTableColumnClass1"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[1]/td[2]" text="A Foo"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[1]/td[2]/@class" text="aDataTableColumnClass2"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[2]/@class" text="aDataTableRowClass2"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[2]/td[1]" text="Bar"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[2]/td[2]" text="A Bar"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[3]/@class" text="aDataTableRowClass1"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[3]/td[1]" text="Baz"/>
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[3]/td[2]" text="A Baz"/>
				<verifyXPath xpath="count(/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr[1]/td)" text="2"/>
				<verifyXPath xpath="count(/html/body/form/table[1]/tbody/tr[5]/td[1]/table/tbody/tr)" text="3"/>

				<!-- Should be nothing else! -->
				
				<verifyXPath xpath="count(/html/body/form/table[1]/tbody/tr)" text="6"/>
				
				<!-- Test the '-1 check' in UIMetawidget.inspect -->
			
				<verifyXPath xpath="count(/html/body/table[1]/tbody/tr)" text="0"/>
				
				<!-- Test rendering Null -->
				
				<verifyXPath xpath="count(/html/body/table[1]/tbody)" text="1"/>
				<verifyXPath xpath="count(/html/body/table[1]/tbody/tr)" text="0"/>

				<!-- Test inline Actions -->
				
				<verifyXPath xpath="/html/body/form/table[1]/tbody/tr[6]/td[1]/input[@type='submit']/@value" text="Refresh"/>
				<clickButton label="Refresh"/>
				<verifyText text="rror"/>
				<setInputField name="form:quirksLarge" value="Some text"/>
				<verifyXPath xpath="count(//input[@value='Refresh'])" text="1"/>

				<clickButton label="Refresh"/>
				<verifyCheckbox htmlid="form:quirksIntegers:2" checked="true"/>
				
				<not>
					<verifyText text="rror"/>
				</not>				
				
				<!-- Test zero columns -->
				
				<invoke url="${webtest.url}/quirks-faces/index2.jsf" />
				<verifyXPath xpath="count(/html/body/table[1]/tbody/tr)" text="13"/>
				<verifyXPath xpath="/html/body/table[1]/tbody/tr[1]/th" text="42 boolean:"/>
				<verifyXPath xpath="count(/html/body/table[1]/tbody/tr[2]/td[1]/table/tbody/tr/td)" text="2"/>
				<verifyXPath xpath="/html/body/table[1]/tbody/tr[2]/td[1]/table/tbody/tr/td[1]/input/@type" text="radio"/>
				<verifyXPath xpath="normalize-space(/html/body/table[1]/tbody/tr[2]/td[1]/table/tbody/tr/td[1]/label, 'Yes (i18n)' )"/>
				<verifyXPath xpath="/html/body/table[1]/tbody/tr[2]/td[1]/table/tbody/tr/td[2]/input/@type" text="radio"/>
				<verifyXPath xpath="normalize-space(/html/body/table[1]/tbody/tr[2]/td[1]/table/tbody/tr/td[2]/label, 'No (i18n)' )"/>
				<verifyXPath xpath="/html/body/table[1]/tbody/tr[3]/td[1]/textarea/@id" text="quirksLarge"/>
				<verifyXPath xpath="/html/body/table[1]/tbody/tr[3]/td[1]/@colspan" text=""/>
				
				<!-- Test duplicated controls -->
				
				<verifyXPath xpath="/html/body/table[2]/tbody/tr[2]/td[1]/textarea/@id" text="quirksLarge_2"/>
				
				<!-- Test overriding a required UIInput with a UIOutput (star should disappear) --> 

				<verifyXPath xpath="/html/body/table[2]/tbody/tr[2]/td[2]" text="*"/>
				<verifyXPath xpath="/html/body/table[3]/tbody/tr[2]/td[2]/div"/>

				<!-- Test 'colspan' on nested Metawidgets: 'rendererType=table' and 'rendererType=simple' -->

				<not>
					<verifyXPath xpath="/html/body/table[3]/tbody/tr[1]/td[1]/@colspan"/>
				</not>
				<verifyXPath xpath="/html/body/table[3]/tbody/tr[3]/td[1]/@colspan" text="2"/>
				
			</steps>
		</webtest>
	</target>

</project>
