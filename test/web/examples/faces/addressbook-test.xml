<project name="faces-addressbook-test" default="test-all">

	<property file="../../../../build.properties" />
	<property name="build.metawidget.dir" value="${build.dir}/metawidget-${metawidget.version}"/>

	<import file="${webtest.dir}/lib/taskdef.xml" />

	<!-- Test Search Screen -->
				
	<target name="test-search">
		<webtest name="test-search">
			<config resultpath="${build.metawidget.dir}"/>
			<steps>
				<invoke url="${webtest.url}/addressbook-faces" />
				<verifyTitle text="Address Book (Metawidget Java Server Faces Example)" />
				
				<verifyXPath xpath="/html/body/div[@id='content']/form/table[@id='table-contactSearch']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[@id='table-contactSearchFirstnames-row']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr/td[@id='table-contactSearchFirstnames-cell']"/>
				
				<verifyXPath xpath="/html/body/div[@id='content']/form/table[@class='table-form']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/th[@class='table-label-column']" text="Firstnames:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[@class='table-component-column']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[@class='required']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tfoot/tr/td[@class='buttons']"/>

				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[1]/td[1]/a" text="Mr Charles Montgomery Burns"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[2]/td[1]/a" text="Mr Homer Simpson"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[3]/td[1]/a" text="Mrs Marjorie Simpson"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[4]/td[1]/a" text="Mrs Maude Flanders"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[5]/td[1]/a" text="Mr Nedward Flanders"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[6]/td[1]/a" text="Mr Waylon Smithers"/>
				<setInputField name="form:contactSearchSurname" value="Simpson"/>
				<clickButton label="Search"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[1]/td[1]/a" text="Mr Homer Simpson"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[2]/td[1]/a" text="Mrs Marjorie Simpson"/>
				<setInputField name="form:contactSearchSurname" value=""/>
				<setSelectField name="form:contactSearchType" value="BUSINESS"/>
				<clickButton label="Search"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[1]/td[1]/a" text="Mr Charles Montgomery Burns"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[2]/td[1]/a" text="Mr Waylon Smithers"/>
			</steps>
		</webtest>
	</target>

	<target name="test-existing-personal">
		<webtest name="test-existing-personal">
			<config resultpath="${build.metawidget.dir}"/>
			<steps>
				<invoke url="${webtest.url}/addressbook-faces" />
				<clickLink label="Mr Homer Simpson"/>
				
				<verifyXPath xpath="/html/body/div[@id='content']/form/table[@id='table-contactCurrent']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[@id='table-contactCurrentTitle-row']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr/td[@id='table-contactCurrentTitle-cell']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/th[@class='table-label-column']" text="Title:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[@class='table-component-column']" text="Mr"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/th[@class='table-label-column']" text="Firstnames:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[@class='table-component-column']" text="Homer"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[3]/th[@class='table-label-column']" text="Surname:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[3]/td[@class='table-component-column']" text="Simpson"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[4]/th[@class='table-label-column']" text="Date of Birth:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[4]/td[@class='table-component-column']" text="5/12/56"/>	
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[5]/th[@class='table-label-column']" text="Gender:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[5]/td[@class='table-component-column']" text="Male"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[6]/th/@colspan" text="3"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[6]/th[@class='section-heading']" text="Contact Details"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/th[@class='table-label-column']" text="Address:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/td[1]/table/tbody/tr[1]/th" text="Street:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/td[1]/table/tbody/tr[1]/td[1]" text="742 Evergreen Terrace"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/td[1]/table/tbody/tr[2]/th" text="City:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/td[1]/table/tbody/tr[2]/td[1]" text="Springfield"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/td[1]/table/tbody/tr[3]/th" text="State:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/td[1]/table/tbody/tr[3]/td[1]" text="Anytown"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/td[1]/table/tbody/tr[4]/th" text="Postcode:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[7]/td[1]/table/tbody/tr[4]/td[1]" text="90701"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[8]/td[@id='table-contactCurrentCommunications-cell']/table[@class='data-table']/tbody/tr[1]/td[1]" text="Telephone"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[8]/td[@id='table-contactCurrentCommunications-cell']/table[@class='data-table']/tbody/tr[1]/td[2]" text="(939) 555-0113"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[8]/td[@id='table-contactCurrentCommunications-cell']/table[@class='data-table']/tbody/tr[1]/td[3]" text=""/>
				<not>
					<verifyText text="owner"/>
				</not>
			
				<clickButton label="Edit"/>
				<verifySelectField name="form:contactCurrentTitle" value="Mr"/>
				<verifyInputField name="form:contactCurrentFirstnames" value="Homer"/>
				<verifyInputField name="form:contactCurrentSurname" value="Simpson"/>
				<verifySelectField name="form:contactCurrentGender" value="MALE"/>
				<verifyInputField name="form:contactCurrentDateOfBirth" value="5/12/56"/>
				<verifyInputField name="form:contactCurrentAddressStreet" value="742 Evergreen Terrace"/>
				<verifyInputField name="form:contactCurrentAddressCity" value="Springfield"/>
				<verifySelectField name="form:contactCurrentAddressState" value="Anytown"/>
				<verifyInputField name="form:contactCurrentAddressPostcode" value="90701"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[8]/td[@id='table-contactCurrentCommunications-cell']/table[@class='data-table']/tbody/tr[1]/td[2]" text="(939) 555-0113"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[8]/td[@id='table-contactCurrentCommunications-cell']/table[@class='data-table']/tbody/tr[1]/td[3]/input/@value" text="Delete"/>
				<setInputField name="form:contactCurrentFirstnames" value="Homer Jay"/>
				
				<clickButton label="Add"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/ul/li" text="Communication type is required"/>
				<setSelectField name="form:communications:communicationCurrentType" value="Fax"/>
				<setInputField name="form:communications:communicationCurrentValue" value="(939) 555-0114"/>
				<clickButton label="Add"/>
				
				<verifyText text="(939) 555-0114"/>
				<verifyInputField name="form:communications:communicationCurrentValue" value=""/>								
				<setSelectField name="form:communications:communicationCurrentType" value="E-mail"/>
				<setInputField name="form:communications:communicationCurrentValue" value="homer@simpsons.com"/>
				<clickButton label="Add"/>

				<clickButton name="form:communications:2:deleteCommunication"/>
				
				<setInputField name="form:contactCurrentDateOfBirth" value="bad date"/>
				<clickButton label="Save"/>
		
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[4]/td[@class='table-component-column']/span[@class='inline-error']" text="Conversion error"/>				
				<setInputField name="form:contactCurrentDateOfBirth" value="5/12/57"/>
				<clickButton label="Save"/>

				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[2]/td[1]/a" text="Mr Homer Jay Simpson"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[2]/td[2]" text="E-mail: homer@simpsons.com, Fax: (939) 555-0114"/>
				
				<clickLink label="Mrs Marjorie Simpson"/>
				
				<clickButton label="Edit"/>
				<verifyTextarea name="form:contactCurrentNotes" text="Known as 'Marge'"/>
			</steps>
		</webtest>
	</target>

	<target name="test-richfaces">
		<webtest name="test-richfaces">
			<config resultpath="${build.metawidget.dir}">
				<header name="User-Agent" value="Mozilla/4.0"/>
				<option name="ThrowExceptionOnScriptError" value="false"/>
			</config>
			<steps>
				<invoke url="${webtest.url}/addressbook-faces/contact-richfaces.jsf?contact.load=1" />

				<clickButton label="Edit"/>	
				<verifySelectField name="form:contactCurrentTitle" value="Mr"/>
				<verifyInputField name="form:contactCurrentFirstnames" value="Homer Jay"/>
				<verifyInputField name="form:contactCurrentSurname" value="Simpson"/>
				<verifySelectField name="form:contactCurrentGender" value="MALE"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[4]/td[1]/span[@id='form:contactCurrentDateOfBirthPopup']"/>
				<verifyInputField name="form:contactCurrentDateOfBirthInputDate" value="May 12, 1957"/>

				<invoke url="${webtest.url}/addressbook-faces/contact-richfaces.jsf?contact.load=6" />

				<clickButton label="Edit"/>
				<verifySelectField name="form:contactCurrentTitle" value="Mr"/>
				<verifyInputField name="form:contactCurrentFirstnames" value="Charles Montgomery"/>
				<verifyInputField name="form:contactCurrentSurname" value="Burns"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[10]/td[1]/table[@class='dr-insldr rich-slider ']"/>	
				<setInputField name="form:contactCurrentNumberOfStaff" value="2"/>
				<clickButton label="Save"/>
	
				<invoke url="${webtest.url}/addressbook-faces/contact-richfaces.jsf?contact.load=6" />
	
				<clickButton label="Edit"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[10]/td[1]/table[@class='dr-insldr rich-slider ']"/>
				<verifyInputField name="form:contactCurrentNumberOfStaff" value="2"/>

			</steps>
		</webtest>
	</target>

	<target name="test-new-business">
		<webtest name="test-new-business">
			<config resultpath="${build.metawidget.dir}"/>
			<steps>
				<invoke url="${webtest.url}/addressbook-faces" />
				<clickButton label="Add Personal Contact"/>
				<verifyInputField name="form:contactCurrentDateOfBirth" value=""/>
				<clickButton label="Cancel"/>
				
				<clickButton label="Add Business Contact"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/th[@class='table-label-column']" text="Title:"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[@class='required']" text="*"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[@class='required']" text="*"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[3]/td[@class='required']" text="*"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[4]/td[@class='required']" text=""/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[8]/td[@id='table-contactCurrentCommunications-cell']/table[@class='data-table']/thead/tr/th[1]" text="Type"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[8]/td[@id='table-contactCurrentCommunications-cell']/table[@class='data-table']/thead/tr/th[@class='column-tiny']"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[8]/td[@id='table-contactCurrentCommunications-cell']/table[@class='data-table']/tfoot/tr/td[@class='column-tiny, table-buttons']"/>
				
				<clickButton label="Add"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[@class='table-component-column']/span[@class='inline-error']" text="Title is required"/>
	
				<setSelectField name="form:contactCurrentTitle" value="Miss"/>
				<setInputField name="form:contactCurrentCompany" value="Some Company"/>
				<clickButton label="Save"/>
				<verifyInputField name="form:contactCurrentCompany" value="Some Company"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[@class='table-component-column']/span[@class='inline-error']" text="Firstnames is required"/>

				<setInputField name="form:contactCurrentFirstnames" value="Business"/>
				<clickButton label="Save"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[3]/td[@class='table-component-column']/span[@class='inline-error']" text="Surname is required"/>
				
				<setInputField name="form:contactCurrentSurname" value="A Very Long Surname Exceeding 50 Characters In Length"/>
				<clickButton label="Save"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[3]/td[@class='table-component-column']/span[@class='inline-error']" text="Surname must not be longer than 50 characters"/>

				<setInputField name="form:contactCurrentSurname" value="Contact"/>
				<setInputField name="form:contactCurrentNumberOfStaff" value="-1"/>
				<clickButton label="Save"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[10]/td[@class='table-component-column']/span[@class='inline-error']" text="Number of Staff must be between 0 and 100"/>
				
				<setInputField name="form:contactCurrentNumberOfStaff" value="2"/>
				<setSelectField name="form:communications:communicationCurrentType" value="Mobile"/>
				<setInputField name="form:communications:communicationCurrentValue" value="(0402) 456 123"/>
				<clickButton label="Add"/>
	
				<clickButton label="Save"/>
				
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[1]/td[1]/a" text="Miss Business Contact"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[1]/td[2]" text="Mobile: (0402) 456 123"/>
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[2]/td[1]/a" text="Mr Charles Montgomery Burns"/>
				<clickLink label="Miss Business Contact"/>
	
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[@class='required']" text=""/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[@class='required']" text=""/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[3]/td[@class='required']" text=""/>
				<clickButton label="Edit"/>
				
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[1]/td[@class='required']" text="*"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[2]/td[@class='required']" text="*"/>
				<verifyXPath xpath="/html/body/div[@id='content']/form/table/tbody/tr[3]/td[@class='required']" text="*"/>
				<verifyInputField name="form:contactCurrentCompany" value="Some Company"/>
				<verifyInputField name="form:contactCurrentNumberOfStaff" value="2"/>
			
				<clickButton label="Delete" index="1"/>
				
				<verifyXPath xpath="/html/body/div[@id='content']/table/tbody/tr[1]/td[1]/a" text="Mr Charles Montgomery Burns"/>
			</steps>
		</webtest>
	</target>

	<target name="test-all" depends="test-search, test-new-business, test-existing-personal, test-richfaces"/>

</project>
